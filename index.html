<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App de Ahorro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .tab-active { border-bottom: 4px solid #ffffff; color: #ffffff; font-weight: 800; }
        #contenedor-tablero::-webkit-scrollbar { width: 4px; }
        #contenedor-tablero::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="pb-24">

    <header class="bg-emerald-600 text-white p-5 sticky top-0 z-50 shadow-lg rounded-b-[2rem]">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div class="flex flex-col">
                <span class="text-[10px] font-black uppercase opacity-80 tracking-widest">App de</span>
                <h2 class="text-sm font-bold leading-tight">Yeiner Saenz Moreno</h2>
            </div>
            <h1 class="text-lg font-black italic flex items-center gap-2">
                Mi App de Ahorro üí∞
            </h1>
        </div>
    </header>

    <main id="pantalla-ahorro" class="p-4 max-w-md mx-auto">
        <div id="sin-meta" class="hidden text-center p-12 bg-white rounded-3xl shadow-sm mt-10 border border-gray-100">
            <p class="text-gray-500 font-bold">¬°Hola Yeiner! Crea una meta para empezar.</p>
            <button onclick="cambiarTab('metas')" class="mt-4 bg-emerald-600 text-white px-8 py-3 rounded-2xl font-black shadow-lg">Crear Meta</button>
        </div>

        <div id="con-meta" class="space-y-4">
            <div class="bg-white p-6 rounded-3xl shadow-md border border-emerald-50 mt-2">
                <div class="w-full bg-gray-100 rounded-full h-5 mb-4 overflow-hidden p-1 border">
                    <div id="barra-progreso" class="bg-emerald-500 h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-[10px] text-gray-400 font-black uppercase tracking-tighter">Dinero Ahorrado</p>
                        <p id="monto-acumulado" class="text-3xl font-black text-emerald-600 tracking-tight">$0</p>
                    </div>
                    <div class="text-right">
                        <p id="porcentaje-texto" class="text-xl font-black text-gray-800">0%</p>
                        <p id="monto-objetivo" class="text-[10px] font-bold text-gray-400">Objetivo: $0</p>
                    </div>
                </div>
            </div>

            <div id="contenedor-tablero" class="grid grid-cols-4 gap-2 bg-white p-4 rounded-3xl shadow-inner max-h-[55vh] overflow-y-auto border border-gray-100">
                </div>
        </div>
    </main>

    <main id="pantalla-metas" class="p-4 max-w-md mx-auto hidden">
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 mb-6">
            <h3 class="font-black mb-4 text-gray-700 uppercase text-xs">Nuevo Reto</h3>
            <input id="input-nombre" type="text" placeholder="¬øQu√© quieres comprar?" class="w-full bg-gray-50 p-4 rounded-2xl mb-3 outline-none focus:ring-2 ring-emerald-400 font-bold">
            <input id="input-valor" type="number" placeholder="Monto total en COP" class="w-full bg-gray-50 p-4 rounded-2xl mb-4 outline-none focus:ring-2 ring-emerald-400 font-bold">
            <button onclick="crearMeta()" class="w-full bg-gray-900 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all uppercase tracking-widest text-xs">Empezar ahora</button>
        </div>

        <h3 class="font-black text-gray-800 mb-4 px-2">Mis Retos Guardados</h3>
        <div id="lista-metas" class="space-y-3 mb-6"></div>
        
        <div class="bg-white p-4 rounded-3xl shadow-sm border border-gray-100">
            <canvas id="graficaMetas"></canvas>
        </div>
    </main>

    <nav class="fixed bottom-0 w-full bg-white border-t flex justify-around p-4 z-50">
        <button onclick="cambiarTab('ahorro')" id="tab-ahorro" class="flex flex-col items-center flex-1 tab-active">
            <span class="text-2xl">üí∞</span>
            <span class="text-[9px] font-black uppercase">Mi Tablero</span>
        </button>
        <button onclick="cambiarTab('metas')" id="tab-metas" class="flex flex-col items-center flex-1 text-gray-300">
            <span class="text-2xl">üèÜ</span>
            <span class="text-[9px] font-black uppercase">Configurar</span>
        </button>
    </nav>

    <script>
        // Usamos una versi√≥n de almacenamiento diferente para evitar conflictos
        let metas = JSON.parse(localStorage.getItem('metas_yeiner_v1')) || [];
        let metaActivaId = localStorage.getItem('meta_activa_id_yeiner') || null;
        let chart;

        function guardar() {
            localStorage.setItem('metas_yeiner_v1', JSON.stringify(metas));
            localStorage.setItem('meta_activa_id_yeiner', metaActivaId);
            renderizarTodo();
        }

        function crearMeta() {
            const nombre = document.getElementById('input-nombre').value;
            const valor = parseInt(document.getElementById('input-valor').value);
            if (!nombre || !valor) return alert("Yeiner, por favor ingresa un nombre y un valor.");

            const nuevaMeta = { 
                id: Date.now(), 
                nombre, 
                objetivo: valor, 
                ahorrados: [] 
            };
            metas.push(nuevaMeta);
            metaActivaId = nuevaMeta.id;
            document.getElementById('input-nombre').value = '';
            document.getElementById('input-valor').value = '';
            cambiarTab('ahorro');
            guardar();
        }

        function marcarBoton(index) {
            const meta = metas.find(m => m.id == metaActivaId);
            if (meta && !meta.ahorrados.includes(index)) {
                meta.ahorrados.push(index);
                guardar();
            }
        }

        function generarTablero(meta) {
            const contenedor = document.getElementById('contenedor-tablero');
            contenedor.innerHTML = '';
            
            let sumaProgresoBotones = 0;
            let acumuladoReal = 0;
            let i = 1;

            while (sumaProgresoBotones < meta.objetivo) {
                const indexFicha = i;
                let valorBoton = i * 1000;
                
                if (sumaProgresoBotones + valorBoton > meta.objetivo) {
                    valorBoton = meta.objetivo - sumaProgresoBotones;
                }

                const estaAhorrado = meta.ahorrados.includes(indexFicha);
                if (estaAhorrado) acumuladoReal += valorBoton;

                const boton = document.createElement('button');
                boton.innerText = valorBoton.toLocaleString('es-CO');
                
                const estiloBase = "p-2 text-[10px] sm:text-[11px] font-bold rounded-xl border-2 transition-all duration-200 h-12 flex items-center justify-center ";
                
                if (estaAhorrado) {
                    boton.className = estiloBase + "bg-emerald-500 text-white border-emerald-600 shadow-inner scale-95 opacity-80";
                    boton.disabled = true;
                } else {
                    boton.className = estiloBase + "bg-white text-gray-700 border-gray-100 hover:border-emerald-400 active:scale-90 active:bg-emerald-50 shadow-sm";
                    boton.onclick = () => marcarBoton(indexFicha);
                }

                contenedor.appendChild(boton);
                sumaProgresoBotones += valorBoton;
                i++;
                if(i > 1500) break; 
            }

            document.getElementById('monto-acumulado').innerText = `$${acumuladoReal.toLocaleString('es-CO')}`;
            document.getElementById('monto-objetivo').innerText = `Objetivo: $${meta.objetivo.toLocaleString('es-CO')}`;
            const porcentaje = (acumuladoReal / meta.objetivo) * 100;
            document.getElementById('barra-progreso').style.width = `${porcentaje}%`;
            document.getElementById('porcentaje-texto').innerText = `${porcentaje.toFixed(1)}%`;
        }

        function renderizarTodo() {
            const meta = metas.find(m => m.id == metaActivaId);
            if (!meta) {
                document.getElementById('con-meta').classList.add('hidden');
                document.getElementById('sin-meta').classList.remove('hidden');
            } else {
                document.getElementById('con-meta').classList.remove('hidden');
                document.getElementById('sin-meta').classList.add('hidden');
                generarTablero(meta);
            }

            const lista = document.getElementById('lista-metas');
            lista.innerHTML = '';
            metas.forEach(m => {
                lista.innerHTML += `
                    <div class="p-4 bg-white rounded-2xl flex justify-between items-center shadow-sm border-2 ${m.id == metaActivaId ? 'border-emerald-500 bg-emerald-50' : 'border-transparent'}">
                        <div onclick="setActiva(${m.id})" class="flex-1 cursor-pointer">
                            <p class="font-black text-gray-800 uppercase text-xs">${m.nombre}</p>
                            <p class="text-[10px] text-gray-400 font-bold tracking-widest">$${m.objetivo.toLocaleString()}</p>
                        </div>
                        <button onclick="borrarMeta(${m.id})" class="text-gray-300 hover:text-red-500 font-bold ml-4 text-xl">√ó</button>
                    </div>
                `;
            });
            actualizarGrafica();
        }

        function setActiva(id) { metaActivaId = id; guardar(); cambiarTab('ahorro'); }
        
        function borrarMeta(id) { 
            if(confirm("Yeiner, ¬øseguro que quieres borrar este ahorro?")) { 
                metas = metas.filter(m => m.id != id); 
                if(metaActivaId==id) metaActivaId=null; 
                guardar(); 
            } 
        }

        function cambiarTab(tab) {
            document.getElementById('pantalla-ahorro').classList.toggle('hidden', tab !== 'ahorro');
            document.getElementById('pantalla-metas').classList.toggle('hidden', tab !== 'metas');
            
            const btnAhorro = document.getElementById('tab-ahorro');
            const btnMetas = document.getElementById('tab-metas');
            
            if(tab === 'ahorro') {
                btnAhorro.className = "flex flex-col items-center flex-1 text-emerald-600 font-black";
                btnMetas.className = "flex flex-col items-center flex-1 text-gray-300";
            } else {
                btnMetas.className = "flex flex-col items-center flex-1 text-emerald-600 font-black";
                btnAhorro.className = "flex flex-col items-center flex-1 text-gray-300";
            }
        }

        function actualizarGrafica() {
            const ctx = document.getElementById('graficaMetas').getContext('2d');
            if (chart) chart.destroy();
            if (metas.length === 0) return;
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: metas.map(m => m.nombre),
                    datasets: [{ 
                        label: 'Botones Marcados', 
                        data: metas.map(m => m.ahorrados.length), 
                        backgroundColor: '#059669', 
                        borderRadius: 12 
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }

        renderizarTodo();
    </script>
</body>
</html>